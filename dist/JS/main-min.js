mapboxgl.accessToken="pk.eyJ1IjoiamVmZnJleXNoZW5jYyIsImEiOiJjamE5MDI4YmowMmMzMndzNDdoZmZnYzF5In0.zV3f0WhqbHeyixwY--TyZg";const map=new mapboxgl.Map({container:"map",style:"mapbox://styles/jeffreyshencc/cl4vs5szm001514pbs41iqwve",center:[-74,40],zoom:6,minZoom:3,pitch:40,bearing:-10,projection:"mercator"});map.addControl(new mapboxgl.FullscreenControl);const nav=new mapboxgl.NavigationControl({visualizePitch:!0});function addCommas(e){var t=e.toString().split(".");const o=t[0],n=t[1];return o.replace(/\B(?=(\d{3})+(?!\d))/g,",")+(n?"."+n:"")}map.addControl(nav,"bottom-right");const popup=new mapboxgl.Popup({closeButton:!1,offset:[0,-15]});function generatePopup(e){const t=map.queryRenderedFeatures(e.point,{layers:["3D-extrusions"]});if(!t.length)return void popup.remove();const o=t[0];o.properties.color="#ff00ff",popup.setLngLat(e.lngLat).setHTML(`<span class = "heading">Block Group ${o.properties.GEOID}</span>\n    <h3 style = "margin-top: 0px; margin-bottom: 5px;">${o.properties.urban_area.split("--")[0]} Urban Area</h3>\n    <p style = "margin-top:5px;margin-bottom:5px">${addCommas(o.properties.vacant_units)} vacant units / ${addCommas(o.properties.total_unit)} total<br> (${o.properties.percent_vacant.toFixed(2)}% empty)</p>`).addTo(map)}function generateEmptyUnitsNumber(){const e=map.queryRenderedFeatures({layers:["3D-extrusions"]});let t=0;if(e){const o=new Set;for(const n of e){const e=n.properties.GEOID;o.has(e)||(o.add(e),t+=n.properties.vacant_units)}}const o=Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:2});document.getElementById("overlay").innerHTML=`\n    ${o.format(t)} vacant units on screen\n  `}function returnToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}map.on("click",generatePopup),map.on("movestart",()=>{document.getElementById("overlay").innerHTML="Calculating vacant units...",popup.remove()}),map.on("load",generateEmptyUnitsNumber),map.on("moveend",generateEmptyUnitsNumber);